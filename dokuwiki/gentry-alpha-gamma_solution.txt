====== Draw pattern of alpha and gamma diversity along latitude using Gentry's forest plots - Solution ======
<code rsplus gentry-alpha-gamma.r>
# Alpha and gamma diversity along a latitudinal gradient - using transect data of Al Gentry

# First, read data from the course website:

# load the object gentry197 (list of 197 elements)
load (url ('https://github.com/zdealveindy/recol/blob/main/data/gentry197.RData?raw=true'))

# load data frame with plot coordinates
gentry.coord <- read.delim ('https://raw.githubusercontent.com/zdealveindy/recol/main/data/gentry.coord.txt', row.names = 1)

# Calculate mean alpha diversity in individual localities - first
# sum the values in the rows which are higher than 1, and then calculate mean of these rowSums
mean.alpha <- unlist (lapply (gentry197, FUN = function (x) mean (rowSums (x > 0))))

# Calculate the gamma diversity of each locality - simply a sum of species occurring in 
# each locality (first sum the columns, and then sum the colSums which are higher than 0)
gamma <- unlist (lapply (gentry197, FUN = function (x) sum (colSums (x) > 0)))

# Extract latitude from gentry.coord
latitude <- gentry.coord$Lat

# Choose the colors (Dark2 in www.colorbrewer2.org)
library (RColorBrewer)
cols <- brewer.pal (n = 3, name = 'Dark2')

# Calculate the range of the y-axis values - min and max values of the merged mean.alpha and gamma diversity values
range.ylim <- c(min (c(mean.alpha, gamma)), max (c(mean.alpha, gamma)))

pdf ('gentry.pdf')
par (mar = c (5.1, 5.1, 4.1, 2.1))

plot (gamma ~ latitude, log = 'y', pch = 17, col = cols[3], ylim = range.ylim, 
      xlab = list ('Absolute latitude', cex = 2), ylab = list ('Diversity', cex = 2))
points (mean.alpha ~ latitude, pch = 16, col = cols[2])

lm.gamma <- lm (log10 (gamma) ~ latitude)
lat.min.max <- c(min(latitude), max (latitude))
pred.gamma <- predict (lm.gamma, newdata = list (latitude = lat.min.max))
lines (10^pred.gamma ~ lat.min.max, lty = 'dashed', col = cols[3], lwd = 2)

lm.mean.alpha <- lm (log10 (mean.alpha) ~ latitude)
pred.mean.alpha <- predict (lm.mean.alpha, newdata = list (latitude = lat.min.max))
lines (10^pred.mean.alpha ~ lat.min.max, lty = 'solid', col = cols[2], lwd = 2)

# Add the text into the figure (mean alpha and gamma)
text (30, 150, expression (gamma), cex = 3, col = cols[3])
text (20, 5, expression (bar (alpha)), cex = 3, col = cols[2])

# And finally, add the 'A' to the top-right corner
legend ('topright', bty = 'n', legend = 'A', cex = 2, text.font = 2)

dev.off ()

# ggplot2 version (approximate solution)
library (tidyverse)
p <- data.frame (latitude = latitude, gamma = gamma, mean.alpha = mean.alpha) %>% 
  pivot_longer (!latitude, names_to = "diversity", values_to = "value") %>%
  ggplot (aes (x = latitude, y = value, color = diversity), ) + 
  geom_point () + 
  geom_smooth (method = 'lm') + 
  scale_y_continuous (trans = 'log10') + 
  theme_bw () + 
  theme (legend.position = 'none', panel.grid.major = element_blank (),
         panel.grid.minor = element_blank ()) + 
  xlab ('Absolute latitude') + 
  ylab ('Diversity') + 
  annotate (geom = 'text', x = 25, y = 5, label = expression (bar (alpha)), size = 10) + 
  annotate (geom = 'text', x = 30, y = 100, label = expression (gamma), size = 10) + 
  annotate (geom = 'text', x = 60, y = 250, label = 'A', size = 10)

ggsave (filename = 'gentry.pdf', plot = p)

 
</code>

Compare the figure created by this script (upper figure showing the base R version, the original pdf version {{:recol:figures:gentry.pdf|here}}) with the actual figure published in the Kraft et al. (2011) (lower)((The figure was modified from Fig. 1A in the original paper in the way that only panel A is shown, and the tick labels + x-axis of the figure was appended from the panel C.)):

{{ :recol:figures:gentry-alpha-gamma.png?nolink |}}{{ :recol:figures:gentry-alpha-gamma-kraft_etal2011.png?nolink |}}
\\
Note that there are some differences - some points in the original figure don't show in our one. The reason is the slight difference in the datasets. When I compiled Gentry's data, I removed all localities with less than ten transects to enable comparability among localities. At the same time, the original Kraft et al. paper perhaps also uses localities with fewer transects. Another reason may be that the original data (which I used here) are raw - they would need some more processing, which I haven't done.