====== Draw pattern of alpha and gamma diversity along latitude using Gentry's forest plots ======

[{{ http://www.davidzeleny.net/anadat-r/lib/exe/fetch.php/obrazky:alwyn-gentry.jpg?cache=TRUE&300|Al Gentry examines leaves during Conservation International’s Rapid Assessment Program expedition to Ecuador in January 1991. Photo from [[http://opinionator.blogs.nytimes.com/2011/01/16/dying-for-discovery|NY Times]].}}]
[[wp>Alwyn Howard Gentry]] (1945-1993) was an American botanist and taxonomist, with a wide range of activities. He developed the sampling design for a rapid inventory of diversity in species-rich tropical forests, later applied also to other regions. In a relatively homogeneous forest stand, he placed **ten contiguous transects** of the size 2 m × 50 m), with the long and narrow shape of the transect allowing fast census. Within each transect, he measured DBH((DBH = diameter in breast height, the diameter of the tree measured at the breast height.)) of each individual of woody species and lianas((Only trees with DBH > 10 cm were measured)).

After Gentry's tragic death (he died in the flight accident while on the way for a field trip in Western Ecuador), the dataset was published in printed version (Phillips & Miller 2002) and also made available [[http://www.mobot.org/MOBOT/research/gentry/transect.shtml|online]].

[{{:recol:figures:gentry-transects-schema.jpg?direct&800|Design of Gentry's forest transects sampled on one of the localities. The detail of a single transect is on the right, with trees indicated by filled green circles. Ten transects per locality have been surveyed. Schema by D. Zelený.}}]


In 2011, Nathan Kraft and his colleagues took this dataset and published the paper in //Science//, entitled //Disentangling the drivers of β-diversity along latitudinal and elevational gradients// (original paper [[https://science.sciencemag.org/content/333/6050/1755|here]], you can download {{:recol:materials:kraft_etal2011_science.pdf|pdf}}). Authors show the pattern of alpha and gamma diversity along the latitudinal gradient. //Alpha diversity// here is the mean number of species in the transects in each locality; //gamma diversity// is the sum of all species in the locality (they show also beta diversity, which is species turnover, but it is not important at this point since we are not going to calculate it).

[{{ :recol:figures:gentry-alpha-gamma-kraft_etal2011.png?direct&350|Fig. 1A from Kraft et al. (2011).}}]

**Please, do the following:** recreate the Fig. 1A from the paper by Kraft et al. (2011) (see figure beside), using the data which I independently downloaded from the original website and prepared for you to use. In this way, we can make sure that the pattern published in the paper is actually correct. Fig. 1A shows the relationship between mean alpha diversity and gamma diversity along the latitudinal gradient - forests are the most diverse in tropics (low latitude) and get poorer when moving north or south of the Equator (toward higher latitudes).

**What to do**:
    - First, load the data into R (I already made the data ready to be uploaded to R((I compiled them from the original website - you may check details [[http://www.davidzeleny.net/anadat-r/doku.php/en:data:gentry|here]] and [[http://www.davidzeleny.net/anadat-r/doku.php/en:data:gentry:extract-gentry-plots|here]] if you are interested.))). You need (1) species composition of individual transects on each of 197 localities and (2) latitude of each locality. Import the following two files: [[https://github.com/zdealveindy/recol/blob/main/data/gentry197.RData?raw=true|gentry197.RData]] and [[https://raw.githubusercontent.com/zdealveindy/recol/main/data/gentry.coord.txt|gentry.coord.txt]]. The first file is an R object ''gentry197'' (list of data frames with compositional data) saved as a file ''gentry197.RData''. Note that this is **an R object**, not an R script((If you attempt to download it and open it as a script, you get just a mess)). You need to use the function ''load'' to load these data - and you should do it directly from the link above (without need to store the file on your computer). The second file is a matrix of coordinates saved in the tab-delimited format as *.txt file.
    - After importing into R, the object ''gentry197'' will appear in your working space. It is actually a list of 197 components, where each list component is a //transect × species//  data frame from one locality. Each locality's data frame has ten rows (one row = one transect) and many columns (one column = one species). Each cell of the data frame represents **a number of individuals** of given species in the given transect (information about the diameter in breast height of individual trees is not considered here). The preview of the data frame from the first locality in ''gentry197'' looks like this (each row = transects, only 5 columns = species): <code rsplus>gentry197[[1]][,1:5]</code><file>
   ANACARDIACEAE M1 M1 ANNONACEAE Monanthotaxis M1 ANNONACEAE Polyalthia henriceii APOCYNACEAE Landolphia M1 APOCYNACEAE Oncinotis M1
1                    0                           0                               1                         2                        1
2                    0                           0                               0                         2                        0
3                    0                           0                               0                         0                        0
4                    0                           0                               0                         1                        0
5                    1                           0                               0                         0                        0
6                    0                           0                               0                         1                        0
7                    0                           0                               0                         1                        0
8                    0                           0                               0                         3                        0
9                    0                           3                               0                         0                        0
10                   0                           0                               0                         1                        0</file>
    - Now you need to calculate //mean alpha diversity// and //gamma diversity// within each locality (i.e. within each component of ''gentry197'' list). //Alpha diversity// of a transect is the number of species in that transect, and the //mean alpha diversity// is the mean number of species in individual transects (mean of transect's alpha diversities); //gamma diversity// is the total number of species in the dataset from a particular locality (i.e. number of species occurring at least once at the locality). So, for //mean alpha diversity// you need to count a number of species in each transect (row of the data frame) and calculate mean of these numbers across ten transects in each locality; for //gamma diversity// you need to calculate a number of species in each data set (basically the number of columns in each data frame whose sum is not zero). Just remember - the number in each cell of the data frame represents //the number of individuals of each species// - but you don't care how many individuals of each species are there, you just need to know whether there is any (species is present) or none (species is absent).
    - Draw the relationship of //mean alpha// and //gamma// diversity along latitude into one plot, add regression lines (linear regression), and also the labels (alpha and gamma). Note that y-axis of the figure __should be log-transformed__!
    - Try to choose colours the most similar to the original figure in Science - you may choose the colour palette from http://colorbrewer2.org/.
    - Create the script in the way that it will directly load the data from this website, and save the figure as a __pdf file__ (default size is ok). The pdf file should be named "gentry_XXXXXX.pdf", where XXXXXX is your student's ID.

<hidden For hints click here ☛>
  - You need to upload two datasets - one using the function ''load'', loading the list ''gentry197'', and the other using ''read.delim'' loading the ''gentry.coord'' data frame with header (environmental) variables (you will need latitude from this data frame). Check [[recol:data_import#import_rdata_file|here]] to see how to download ''*.RData'' file directly from the Internet.
   - You may check the structure of list by ''str'', and the number of elements by ''length'', names of the localities (elements) by ''names''. The structure of the list looks like the one on the schema on the right. [{{ :recol:figures:gentry197_data_structure.jpg?direct&400|The structure of the ''gentry197'' list (click to enlarge). Note that this is a simplified schema made by me in Excel, just to demonstrate how the data look like...}}]
  - The easiest is to use the function ''lapply'', working on the list - applying the function defined in argument FUN on each element of the list separately, and returning the list of results. You may also need functions like ''colSums'' or ''rowSums''. Just note if you want to know how many species are there in one transect (row of data frame), you cannot simply sum the numbers in each row - you will not get a number of species, but the number of individuals (of all species) in the transect (in each transect, some tree species occur by only one individual, but some species may have many individuals - just imagine how the real forest looks like). There is also prepared function ''specnumber'' in ''library (vegan)'', which - if applied on the matrix of samples x species returns the species richness (number of species) in each row (sample). To turn the resulting //list// object into //vector// of values, use ''unlist''.
  - Here are some main troubles:
    - Log-transformation of the y-axis makes it a bit difficult with adding the regression line. You can achieve the log-transformation of y-axis by adding the argument ''log = 'y' '' into ''plot'' function, to get axis labels on the y-axis in the original diversity values (numbers of species). When calculating the regression, calculate it on log-transformed diversity values (alpha or gamma), and later transform the predicted values using function ''exp'' back to the original not-log-transformed scale (because ''exp (log (x)) == x''). 
    - Log-transformation of y-axis makes also more complicated to set up the range of y-axis values using ''ylim'' argument in ''plot'' function. This cannot start from zero, since log (0) is not defined; you need to start from non-zero positive value. The hint is to check what is the lowest displayed diversity value (either gamma or mean alpha) and use this as the minimum value on the y-axis; similarly, you may check what is the highest value and use it as the maximum value.
    - Adding the labels into the diagram - you need to add gamma (γ) and mean alpha (α letter with a bar above). Use function ''text'' with coordinates of the position, and wrap the text into function ''expression''. Check how to draw α letter with __bar__ above in ??plotmath.
  - For me, the most similar seems to be the palette called //Dark2//. You need only two colours, but the http://colorbrewer2.org/ and RColorBrewer will force you to choose three - but you can still use just two from this selection.
  - Use ''pdf'' function and don't forget to use also ''dev.off'' in the end...

My final figure looks like this (you may try to get similar):
{{ :recol:figures:gentry-alpha-gamma.png?nolink |}}
</hidden>
\\


[[recol:exercise:gentry-alpha-gamma:gentry-alpha-gamma_solution|Solution]]